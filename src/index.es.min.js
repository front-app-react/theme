import e,{useState as t,useEffect as n,useCallback as r,useContext as o}from"react";import{ThemeProvider as i,ThemeContext as c}from"styled-components";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){return e=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!==a(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"===a(e)?e:String(e)}function s(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let g=((f={})[f.lightest=-2]="lightest",f[f.lighter=-1]="lighter",f[f.default=0]="default",f[f.darker=1]="darker",f[f.darkest=2]="darkest",f);var f;class u{constructor(){s(this,"_data",{})}clear(){this.t={}}getItem(e){return this.t[e]}setItem(e,t){this.t[e]=t}removeItem(e){delete this.t[e]}get length(){return Object.getOwnPropertyNames(this.t).length}key(e){return Object.getOwnPropertyNames(this.t)[e]}}function y(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);e=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/i.exec(e);let n=0,r=0,o=0;return t&&4===t.length?(n=parseInt(t[1],16),r=parseInt(t[2],16),o=parseInt(t[3],16)):e&&4<=e.length&&(n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3])),{r:n,g:r,b:o}}function p(e,t,n){let{r:r,g:o,b:i}=e;return 255<(r+=t)?r=255:r<0&&(r=0),255<(o=(255&o)+t)?o=255:o<0&&(o=0),255<(i=(255&i)+t)?i=255:i<0&&(i=0),`rgba(${r},${o},${i},${n})`}const h=async(e,t)=>("sizing"===e?await fetch(process.env.PUBLIC_URL+"/theme/sizing.json"):"color"===t?await fetch(process.env.PUBLIC_URL+`/theme/colors/${e}.json`):await fetch(process.env.PUBLIC_URL+`/langs/${e}.json`)).json();function d(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)),r}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const m={"theme.dir":"ltr","theme.locale":"en-US","theme.language":"english","theme.langLabel":"en"},O=(e,n,r)=>{const[o,i]=t({dictionary:m,loading:!0});return{dictionary:o.dictionary,onChange:async t=>{let c;if(i((e=>b(b({},e),{},{loading:!0}))),"string"==typeof t)try{c=await r(t),console.log("lang async 1")}catch(t){}else c=t,console.log("lang 1");return n.setItem(e+"-lang",c?.["theme.locale"]||o.dictionary["theme.locale"]),i((e=>b(b({},e),{},{dictionary:c,loading:!1}))),console.log("lang async 2"),c||o.dictionary},loading:o.loading}};function j(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)),r}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const w=(e,o,i,c)=>{const[a,l]=t({color:{data:{},name:""},sizing:"function"!=typeof c?c:{btn:{},input:{}},loadingSizing:"function"==typeof c,loadingColor:!0,loading:!0});n((()=>{if("function"==typeof c)return l((e=>v(v({},e),{},{loadingSizing:!0}))),c().then((e=>{l((t=>v(v({},t),{},{loadingSizing:!1,sizing:e})))})).catch((e=>{l((e=>v(v({},e),{},{loadingSizing:!1})))})),()=>{}}),[]);var s=r(((e,t,n)=>{if("transparent"===e)return"transparent";console.log({state:a});var r=y(a.color&&e?a.color.data[e]:"#000000");switch(n=void 0!==n?n:1,t){case 1:return p(r,-15,n);case 2:return p(r,-30,n);case-1:return p(r,15,n);case-2:return p(r,30,n);default:return p(r,0,n)}}),[a]);return v(v({},a),{},{onChange:async t=>{let n;if(l((e=>v(v({},e),{},{loadingColor:!0}))),"string"==typeof t)try{n=await i(t),console.log("color async 1")}catch(t){}else n=t,console.log("color 1");return o.setItem(e+"-color",n.name||a.color),l((e=>v(v({},e),{},{color:n,loadingColor:!1}))),console.log("color async 2"),n||a.color},getColor:s,loading:a.loadingColor&&a.loadingSizing})},P=({children:t,prefix:r,storage:o=new u,defaultLang:c,defaultColor:a,defaultSizing:l})=>{const s=w(r,o,"function"!=typeof a||"string"==typeof a?e=>h(e,"color"):a,void 0===l?()=>h("sizing"):l),g=O(r,o,"function"!=typeof c||"string"==typeof c?e=>h(e,"lang"):c);return n((()=>((async()=>{var e=o.getItem(r+"-lang"),t=o.getItem(r+"-color");e?g.onChange(e):"object"==typeof c&&c.fetch&&"function"==typeof c.fetch?(e=await c.fetch(c.value),g.onChange(e)):g.onChange(c),t?s.onChange(t):"object"==typeof(e=a)&&e.fetch&&"function"==typeof e.fetch?(t=await e.fetch(e.value),s.onChange(t)):s.onChange(e)})(),()=>{})),[]),e.createElement(i,{theme:{style:s,lang:g}},t)},S=()=>o(c);export{g as IMoodColor,P as ThemeProvider,u as ThemeStorage,y as convertRgb,h as defaultFetch,p as lightenDarkenColor,O as useLang,w as useStyle,S as useTheme};
