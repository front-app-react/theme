import t,{useState as e,useEffect as r,useCallback as o,useContext as n}from"react";import{convertRgb as i,lightenDarkenColor as c}from"./utilityColor.es.min.js";import{ThemeProvider as l,ThemeContext as a}from"styled-components";import{defaultFetch as s}from"./defaultFetch.es.min.js";function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t){return t=function(t,e){if("object"!==g(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);if("object"!==g(r=r.call(t,e||"default")))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string"),"symbol"===g(t)?t:String(t)}function u(t,e,r){return(e=f(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}let y=((p={})[p.lightest=-2]="lightest",p[p.lighter=-1]="lighter",p[p.default=0]="default",p[p.darker=1]="darker",p[p.darkest=2]="darkest",p);var p;class m{constructor(){u(this,"_data",{})}clear(){this.t={}}getItem(t){return this.t[t]}setItem(t,e){this.t[t]=e}removeItem(t){delete this.t[t]}get length(){return Object.getOwnPropertyNames(this.t).length}key(t){return Object.getOwnPropertyNames(this.t)[t]}}function h(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)),o}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){u(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}const d={"theme.dir":"ltr","theme.locale":"en-US","theme.language":"english","theme.langLabel":"en"},O=(t,r,o)=>{const[n,i]=e({dictionary:d,loading:!0});return{dictionary:n.dictionary,onChange:async e=>{let c;if(i((t=>b(b({},t),{},{loading:!0}))),"string"==typeof e)try{c=await o(e),console.log("lang async 1")}catch(e){}else c=e,console.log("lang 1");return r.setItem(t+"-lang",c?.["theme.locale"]||n.dictionary["theme.locale"]),i((t=>b(b({},t),{},{dictionary:c,loading:!1}))),console.log("lang async 2"),c||n.dictionary},loading:n.loading}};function j(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)),o}function v(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?j(Object(r),!0).forEach((function(e){u(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}const w=(t,n,l,a)=>{const[s,g]=e({color:{data:{},name:""},sizing:"function"!=typeof a?a:{btn:{},input:{}},loadingSizing:"function"==typeof a,loadingColor:!0,loading:!0});r((()=>{if("function"==typeof a)return g((t=>v(v({},t),{},{loadingSizing:!0}))),a().then((t=>{g((e=>v(v({},e),{},{loadingSizing:!1,sizing:t})))})).catch((t=>{g((t=>v(v({},t),{},{loadingSizing:!1})))})),()=>{}}),[]);var f=o(((t,e,r)=>{if("transparent"===t)return"transparent";console.log({state:s});var o=i(s.color&&t?s.color.data[t]:"#000000");switch(r=void 0!==r?r:1,e){case 1:return c(o,-15,r);case 2:return c(o,-30,r);case-1:return c(o,15,r);case-2:return c(o,30,r);default:return c(o,0,r)}}),[s]);return v(v({},s),{},{onChange:async e=>{let r;if(g((t=>v(v({},t),{},{loadingColor:!0}))),"string"==typeof e)try{r=await l(e),console.log("color async 1")}catch(e){}else r=e,console.log("color 1");return n.setItem(t+"-color",r.name||s.color),g((t=>v(v({},t),{},{color:r,loadingColor:!1}))),console.log("color async 2"),r||s.color},getColor:f,loading:s.loadingColor&&s.loadingSizing})},P=({children:e,prefix:o,storage:n=new m,defaultLang:i,defaultColor:c,defaultSizing:a})=>{const g=w(o,n,"function"!=typeof c||"string"==typeof c?t=>s(t,"color"):c,void 0===a?()=>s("sizing"):a),f=O(o,n,"function"!=typeof i||"string"==typeof i?t=>s(t,"lang"):i);return r((()=>((async()=>{var t=n.getItem(o+"-lang"),e=n.getItem(o+"-color");t?f.onChange(t):"object"==typeof i&&i.fetch&&"function"==typeof i.fetch?(t=await i.fetch(i.value),f.onChange(t)):f.onChange(i),e?g.onChange(e):"object"==typeof(t=c)&&t.fetch&&"function"==typeof t.fetch?(e=await t.fetch(t.value),g.onChange(e)):g.onChange(t)})(),()=>{})),[]),t.createElement(l,{theme:{style:g,lang:f}},e)},S=()=>n(a);export{y as IMoodColor,P as ThemeProvider,m as ThemeStorage,O as useLang,w as useStyle,S as useTheme};
